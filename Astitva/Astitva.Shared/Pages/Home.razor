@page "/"
@using Astitva.Shared.Services
@inject IFormFactor FormFactor

<PageTitle>Astitva - Home</PageTitle>

<div class="home-page-wrapper">
	<div class="home-background">
		<div class="floating-shapes">
			<div class="shape shape-1"></div>
			<div class="shape shape-2"></div>
			<div class="shape shape-3"></div>
			<div class="shape shape-4"></div>
			<div class="shape shape-5"></div>
		</div>
	</div>

	<div class="home-container">
		<!-- Header Section -->
		<div class="home-header">
			<div class="welcome-section">
				<div class="app-logo">
					<div class="logo-icon">📋</div>
				</div>
				<h1 class="welcome-title">Welcome to Astitva</h1>
				<p class="welcome-subtitle">Your Digital Certificate Manager</p>
			</div>

			<div class="user-actions">
				<SfButton Content="Log Out"
						  CssClass="logout-button"
						  OnClick="Logout" />
			</div>
		</div>

		<!-- Main Content -->
		<div class="home-content">
			@if (_isLoading)
			{
				<div class="loading-container">
					<div class="loading-spinner"></div>
					<p class="loading-text">Loading your certificates...</p>
				</div>
			}
			else if (HasCertificates)
			{
				<div class="certificates-section">
					<h2 class="section-title">Your Certificates</h2>
					<div class="certificates-grid">
						@if (_birthCertificate is not null)
						{
							<div class="certificate-card birth-certificate">
								<div class="card-header">
									<div class="certificate-icon">👶</div>
									<div class="certificate-type">Birth Certificate</div>
								</div>
								<div class="card-content">
									<h3 class="certificate-name">@GetFullName(_birthCertificate.FirstName, _birthCertificate.MiddleName, _birthCertificate.LastName)</h3>
									<div class="certificate-details">
										<div class="detail-item">
											<span class="detail-label">Date of Birth:</span>
											<span class="detail-value">@_birthCertificate.DateOfBirth.ToString("dd MMM yyyy")</span>
										</div>
										<div class="detail-item">
											<span class="detail-label">Registration No:</span>
											<span class="detail-value">@_birthCertificate.RegistrationNo</span>
										</div>
									</div>
								</div>
								<div class="card-actions">
									<SfButton Content="Download"
											  CssClass="download-button primary-button"
											  OnClick="DownloadBirthCertificate" />
								</div>
							</div>
						}

						@if (_deathCertificate is not null)
						{
							<div class="certificate-card death-certificate">
								<div class="card-header">
									<div class="certificate-icon">🕊️</div>
									<div class="certificate-type">Death Certificate</div>
								</div>
								<div class="card-content">
									<h3 class="certificate-name">@GetFullName(_deathCertificate.FirstName, _deathCertificate.MiddleName, _deathCertificate.LastName)</h3>
									<div class="certificate-details">
										<div class="detail-item">
											<span class="detail-label">Date of Death:</span>
											<span class="detail-value">@_deathCertificate.DateOfDeath.ToString("dd MMM yyyy")</span>
										</div>
										@if (_deathCertificate.RegistrationNo.HasValue)
										{
											<div class="detail-item">
												<span class="detail-label">Registration No:</span>
												<span class="detail-value">@_deathCertificate.RegistrationNo</span>
											</div>
										}
									</div>
								</div>
								<div class="card-actions">
									<SfButton Content="Download"
											  CssClass="download-button primary-button"
											  OnClick="DownloadDeathCertificate" />
								</div>
							</div>
						}
					</div>
				</div>
			}
			else
			{
				<div class="no-certificates-section">
					<div class="empty-state">
						<div class="empty-icon">📄</div>
						<h2 class="empty-title">No Certificates Found</h2>
						<p class="empty-description">Start by adding your certificate details to get started with digital certificate management.</p>
					</div>
				</div>
			}

			<!-- Blockchain Verification Section -->
			<div class="blockchain-section">
				<h2 class="section-title">🔗 Blockchain Verification</h2>
				<div class="blockchain-info">
					<div class="blockchain-card">
						<div class="blockchain-icon">⛓️</div>
						<div class="blockchain-content">
							<h3>Certificate Authenticity</h3>
							<p>All certificates are secured on our blockchain for immutable verification and fraud prevention.</p>
							<SfButton Content="Verify Certificate"
									  CssClass="verify-button primary-button"
									  OnClick="NavigateToVerification" />
						</div>
					</div>
					@if (blockchainStats != null)
					{
						<div class="blockchain-stats-mini">
							<div class="stat-mini">
								<span class="stat-number">@blockchainStats.TotalBlocks</span>
								<span class="stat-label">Blocks</span>
							</div>
							<div class="stat-mini">
								<span class="stat-number">@(blockchainStats.BirthCertificates + blockchainStats.DeathCertificates)</span>
								<span class="stat-label">Certificates</span>
							</div>
							<div class="stat-mini">
								<span class="stat-status @(blockchainStats.IsValid ? "valid" : "invalid")">
									@(blockchainStats.IsValid ? "✅" : "❌")
								</span>
								<span class="stat-label">Status</span>
							</div>
						</div>
					}
				</div>
			</div>

			<!-- Add Certificate Section -->
			<div class="add-certificates-section">
				<h2 class="section-title">Add New Certificate</h2>
				<div class="add-certificates-grid">

					@if (_birthCertificate is null)
					{
						<div class="add-certificate-card">
							<div class="add-card-content">
								<div class="add-certificate-icon">👶</div>
								<h3 class="add-certificate-title">Birth Certificate</h3>
								<p class="add-certificate-description">Register a new birth certificate with complete details</p>
							</div>
							<SfButton Content="Add Birth Certificate"
									  CssClass="add-button primary-button"
									  OnClick="NavigateToBirthCertificate" />
						</div>
					}

					@if (_deathCertificate is null)
					{
						<div class="add-certificate-card">
							<div class="add-card-content">
								<div class="add-certificate-icon">🕊️</div>
								<h3 class="add-certificate-title">Death Certificate</h3>
								<p class="add-certificate-description">Register a new death certificate with complete details</p>
							</div>
							<SfButton Content="Add Death Certificate"
									  CssClass="add-button primary-button"
									  OnClick="NavigateToDeathCertificate" />
						</div>
					}
				</div>
			</div>
		</div>
	</div>
</div>

@code {
	private string GetFullName(string firstName, string middleName, string lastName)
	{
		var parts = new[] { firstName, middleName, lastName }.Where(p => !string.IsNullOrWhiteSpace(p));
		return string.Join(" ", parts);
	}
}