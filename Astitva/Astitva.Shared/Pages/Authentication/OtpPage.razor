@page "/otp/{Number}"

<div class="otp-page">
	<div class="otp-container">
		<!-- Header Section -->
		<div class="otp-header">
			<button class="back-btn" @onclick="GoBack" disabled="@_isVerifying">
				<svg width="24" height="24" viewBox="0 0 24 24" fill="none">
					<path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
				</svg>
			</button>
			<h1 class="page-title">Verify Phone</h1>
			<div></div> <!-- Spacer for flexbox -->
		</div>

		<!-- Main Content -->
		<div class="otp-content">
			<div class="otp-icon @(_isSuccess ? "success" : "") @(_hasError ? "error" : "") @(_isVerifying ? "verifying" : "")">
				@if (_isSuccess)
				{
					<svg width="80" height="80" viewBox="0 0 24 24" fill="none">
						<circle cx="12" cy="12" r="10" fill="#10B981"/>
						<path d="m9 12 2 2 4-4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
					</svg>
				}
				else if (_hasError)
				{
					<svg width="80" height="80" viewBox="0 0 24 24" fill="none">
						<circle cx="12" cy="12" r="10" fill="#EF4444"/>
						<path d="m15 9-6 6M9 9l6 6" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
					</svg>
				}
				else
				{
					<svg width="80" height="80" viewBox="0 0 24 24" fill="none">
						<path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" fill="#3B82F6"/>
						<circle cx="12" cy="12" r="3" fill="white"/>
					</svg>
				}
			</div>

			<div class="otp-info">
				<h2 class="otp-title">
					@if (_isSuccess)
					{
						<span>Verified Successfully!</span>
					}
					else if (_hasError)
					{
						<span>Invalid Code</span>
					}
					else
					{
						<span>Enter Verification Code</span>
					}
				</h2>
				<p class="otp-description">
					@if (_isSuccess)
					{
						<span>Your phone number has been verified successfully. Redirecting...</span>
					}
					else if (_hasError)
					{
						<span>The code you entered is incorrect. Please try again.</span>
					}
					else
					{
						<span>We've sent a 6-digit code to <strong>+91 @Number</strong></span>
					}
				</p>
			</div>

			<!-- OTP Input Section -->
			@if (!_isSuccess)
			{
				<div class="otp-input-section">
					<div class="otp-inputs" id="otp-inputs">
						@for (int i = 0; i < 6; i++)
						{
							int index = i;
							<input type="text" 
								   class="otp-digit @(_hasError ? "error" : "")" 
								   maxlength="1" 
								   @onkeydown="@(e => HandleKeyDown(e, index))"
								   @oninput="@(e => HandleInput(e, index))"
								   @onfocus="@(e => HandleFocus(index))"
								   disabled="@_isVerifying"
								   value="@GetDigitValue(index)" />
						}
					</div>
					
					@if (_hasError)
					{
						<div class="error-message">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none">
								<circle cx="12" cy="12" r="10" stroke="#EF4444" stroke-width="2"/>
								<line x1="15" y1="9" x2="9" y2="15" stroke="#EF4444" stroke-width="2"/>
								<line x1="9" y1="9" x2="15" y2="15" stroke="#EF4444" stroke-width="2"/>
							</svg>
							<span>Incorrect code. Please try again.</span>
						</div>
					}
				</div>

				<!-- Timer and Actions -->
				<div class="otp-footer">
					<div class="timer-section">
						@if (_timeRemaining > 0)
						{
							<span class="timer-text">Code expires in <span class="timer">@GetFormattedTime()</span></span>
						}
						else
						{
							<span class="expired-text">Code expired</span>
						}
					</div>

					<div class="resend-section">
						@if (_canResend)
						{
							<button class="resend-btn" @onclick="ResendOTP" disabled="@_isVerifying">
								<svg width="16" height="16" viewBox="0 0 24 24" fill="none">
									<path d="M1 4v6h6M23 20v-6h-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
									<path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
								</svg>
								Resend Code
							</button>
						}
						else
						{
							<span class="resend-wait">Resend available in @GetFormattedTime()</span>
						}
					</div>
				</div>
			}

			<!-- Loading State -->
			@if (_isVerifying)
			{
				<div class="loading-overlay">
					<div class="loading-spinner"></div>
					<p class="loading-text">Verifying code...</p>
				</div>
			}
		</div>
	</div>
</div>

<script>
	window.focusElement = function (selector) {
		const element = document.querySelector(selector);
		if (element) {
			element.focus();
		}
	};
</script>