@page "/certificate/birth"
@using AstitvaLibrary.Models
@using AstitvaLibrary.Data

<PageTitle>Birth Certificate - Astitva</PageTitle>

<div class="certificate-page-wrapper">
	<div class="certificate-background">
		<div class="floating-shapes">
			<div class="shape shape-1"></div>
			<div class="shape shape-2"></div>
			<div class="shape shape-3"></div>
			<div class="shape shape-4"></div>
		</div>
	</div>

	<div class="certificate-container">
		@if (_isLoading)
		{
			<div class="loading-container">
				<div class="loading-spinner"></div>
				<p class="loading-text">Loading birth certificate form...</p>
			</div>
		}
		else
		{
			<div class="certificate-form-card">
				<!-- Header -->
				<div class="form-header">
					<div class="form-icon">👶</div>
					<h1 class="form-title">Birth Certificate Application</h1>
					<p class="form-subtitle">Please fill in all required information carefully</p>
				</div>

				<!-- Validation Summary -->
				@if (_showValidationSummary && _validationErrors.Any())
				{
					<div class="validation-summary">
						<div class="validation-header">
							<span class="validation-icon">⚠️</span>
							<span class="validation-title">Please correct the following errors:</span>
						</div>
						<ul class="validation-list">
							@foreach (var error in _validationErrors.Values)
							{
								<li>@error</li>
							}
						</ul>
					</div>
				}

				<!-- Form Content -->
				<div class="form-content">
					<!-- Personal Information Section -->
					<div class="form-section">
						<h3 class="section-title">Personal Information</h3>
						<div class="form-row">
							<div class="form-group required">
								<label class="form-label">First Name</label>
								<div class="input-wrapper @GetValidationClass("FirstName")">
									<SfTextBox @bind-Value="_birthCertificateModel.FirstName" 
											   Placeholder="Enter first name"
											   CssClass="form-input"
											   MaxLength="50"
											   Enabled="!_isSaving" />
								</div>
								@if (!string.IsNullOrEmpty(GetValidationMessage("FirstName")))
								{
									<div class="validation-message">@GetValidationMessage("FirstName")</div>
								}
							</div>

							<div class="form-group">
								<label class="form-label">Middle Name</label>
								<div class="input-wrapper @GetValidationClass("MiddleName")">
									<SfTextBox @bind-Value="_birthCertificateModel.MiddleName" 
											   Placeholder="Enter middle name (optional)"
											   CssClass="form-input"
											   MaxLength="50"
											   Enabled="!_isSaving" />
								</div>
								@if (!string.IsNullOrEmpty(GetValidationMessage("MiddleName")))
								{
									<div class="validation-message">@GetValidationMessage("MiddleName")</div>
								}
							</div>
						</div>

						<div class="form-row">
							<div class="form-group">
								<label class="form-label">Last Name</label>
								<div class="input-wrapper @GetValidationClass("LastName")">
									<SfTextBox @bind-Value="_birthCertificateModel.LastName" 
											   Placeholder="Enter last name (optional)"
											   CssClass="form-input"
											   MaxLength="50"
											   Enabled="!_isSaving" />
								</div>
								@if (!string.IsNullOrEmpty(GetValidationMessage("LastName")))
								{
									<div class="validation-message">@GetValidationMessage("LastName")</div>
								}
							</div>

							<div class="form-group required">
								<label class="form-label">Sex</label>
								<div class="input-wrapper @GetValidationClass("Sex")">
									<SfDropDownList TItem="string" 
													TValue="string" 
													DataSource="@(new[] { "Male", "Female", "Other" })"
													@bind-Value="_birthCertificateModel.Sex"
													Placeholder="Select sex"
													CssClass="form-input"
													Enabled="!_isSaving">
									</SfDropDownList>
								</div>
								@if (!string.IsNullOrEmpty(GetValidationMessage("Sex")))
								{
									<div class="validation-message">@GetValidationMessage("Sex")</div>
								}
							</div>
						</div>

						<div class="form-row">
							<div class="form-group required">
								<label class="form-label">Date of Birth</label>
								<div class="input-wrapper @GetValidationClass("DateOfBirth")">
									<SfDatePicker @bind-Value="_birthCertificateModel.DateOfBirth" 
												  Placeholder="Select date of birth"
												  CssClass="form-input"
												  Max="DateTime.Now"
												  Min="DateTime.Now.AddYears(-150)"
												  Format="dd/MM/yyyy"
												  Enabled="!_isSaving" />
								</div>
								@if (!string.IsNullOrEmpty(GetValidationMessage("DateOfBirth")))
								{
									<div class="validation-message">@GetValidationMessage("DateOfBirth")</div>
								}
							</div>

							<div class="form-group">
								<label class="form-label">Birth Place</label>
								<div class="input-wrapper @GetValidationClass("BirthPlace")">
									<SfTextBox @bind-Value="_birthCertificateModel.BirthPlace" 
											   Placeholder="Enter birth place (optional)"
											   CssClass="form-input"
											   MaxLength="200"
											   Enabled="!_isSaving" />
								</div>
								@if (!string.IsNullOrEmpty(GetValidationMessage("BirthPlace")))
								{
									<div class="validation-message">@GetValidationMessage("BirthPlace")</div>
								}
							</div>
						</div>
					</div>

					<!-- Parent Information Section -->
					<div class="form-section">
						<h3 class="section-title">Parent Information</h3>
						<div class="form-row">
							<div class="form-group">
								<label class="form-label">Father's Name</label>
								<div class="input-wrapper @GetValidationClass("FatherName")">
									<SfTextBox @bind-Value="_birthCertificateModel.FatherName" 
											   Placeholder="Enter father's name (optional)"
											   CssClass="form-input"
											   MaxLength="100"
											   Enabled="!_isSaving" />
								</div>
								@if (!string.IsNullOrEmpty(GetValidationMessage("FatherName")))
								{
									<div class="validation-message">@GetValidationMessage("FatherName")</div>
								}
							</div>

							<div class="form-group">
								<label class="form-label">Mother's Name</label>
								<div class="input-wrapper @GetValidationClass("MotherName")">
									<SfTextBox @bind-Value="_birthCertificateModel.MotherName" 
											   Placeholder="Enter mother's name (optional)"
											   CssClass="form-input"
											   MaxLength="100"
											   Enabled="!_isSaving" />
								</div>
								@if (!string.IsNullOrEmpty(GetValidationMessage("MotherName")))
								{
									<div class="validation-message">@GetValidationMessage("MotherName")</div>
								}
							</div>
						</div>
					</div>

					<!-- Registration Information Section -->
					<div class="form-section">
						<h3 class="section-title">Registration Information</h3>
						<div class="form-row">
							<div class="form-group required">
								<label class="form-label">Municipality</label>
								<div class="input-wrapper @GetValidationClass("MunicipalityId")">
									<SfComboBox TItem="MunicipalityModel"
												TValue="int"
												DataSource="_municipalities"
												@bind-Value="_birthCertificateModel.MunicipalityId"
												Placeholder="Select municipality"
												CssClass="form-input"
												Enabled="!_isSaving">
										<ComboBoxFieldSettings Text="Name" Value="Id" />
									</SfComboBox>
								</div>
								@if (!string.IsNullOrEmpty(GetValidationMessage("MunicipalityId")))
								{
									<div class="validation-message">@GetValidationMessage("MunicipalityId")</div>
								}
							</div>

							<div class="form-group">
								<label class="form-label">Registration Number</label>
								<div class="input-wrapper @GetValidationClass("RegistrationNo")">
									<SfNumericTextBox @bind-Value="_birthCertificateModel.RegistrationNo" 
													  Placeholder="Registration number (optional)"
													  CssClass="form-input"
													  Enabled="!_isSaving" />
								</div>
								@if (!string.IsNullOrEmpty(GetValidationMessage("RegistrationNo")))
								{
									<div class="validation-message">@GetValidationMessage("RegistrationNo")</div>
								}
							</div>
						</div>

						<div class="form-row">
							<div class="form-group full-width">
								<label class="form-label">Address</label>
								<div class="input-wrapper @GetValidationClass("Address")">
									<SfTextBox @bind-Value="_birthCertificateModel.Address" 
											   Placeholder="Enter current address (optional)"
											   CssClass="form-input"
											   Multiline="true"
											   MaxLength="500"
											   Enabled="!_isSaving" />
								</div>
								@if (!string.IsNullOrEmpty(GetValidationMessage("Address")))
								{
									<div class="validation-message">@GetValidationMessage("Address")</div>
								}
							</div>
						</div>
					</div>
				</div>

				<!-- Form Actions -->
				<div class="form-actions">
					<SfButton Content="🎙️ Voice Assistant" 
							  CssClass="voice-button secondary-button" 
							  OnClick="OnVoiceAssistantClick" 
							  Disabled="_isSaving" />
					<SfButton Content="Clear Form" 
							  CssClass="clear-button secondary-button" 
							  OnClick="ClearForm" 
							  Disabled="_isSaving" />
					<SfButton Content="Cancel" 
							  CssClass="cancel-button secondary-button" 
							  OnClick="CancelForm" 
							  Disabled="_isSaving" />
					@if (_birthCertificateModel.Id > 0)
					{
						<SfButton Content="Download Certificate" 
								  CssClass="download-button secondary-button" 
								  OnClick="DownloadCertificate" 
								  Disabled="_isSaving" />
					}
					<SfButton Content="@GetButtonContent()" 
							  CssClass="@GetButtonClass()" 
							  OnClick="SaveDetails" 
							  Disabled="_isSaving" />
				</div>
			</div>
		}
	</div>

	<!-- Voice Control Dialog -->
	<SfDialog IsModal="true" Width="520px" @bind-Visible="@_showVoiceDialog" CssClass="voice-dialog">
		<DialogTemplates>
			<Header>
				<div class="dialog-header">
					<svg class="dialog-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
						<path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5z" />
						<path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
					</svg>
					<span>Voice Assistance - Birth Certificate</span>
				</div>
			</Header>
			<Content>
				<div class="dialog-content">
					<div class="voice-dialog-body">
						<SfSpeechToText @bind-Transcript="@_transcript" />
						<SfTextArea RowCount="3" ColumnCount="50" @bind-Value="@_transcript" ResizeMode="Resize.None" Placeholder="Speak now, or type your query here..." CssClass="voice-transcript" />

						<div class="transcript-instructions">
							<p>Try saying something like:</p>
							<ul>
								<li>"First name John, middle name Michael, last name Smith"</li>
								<li>"Male, born on March 15th 1990"</li>
								<li>"Father's name Robert Smith, mother's name Sarah Johnson"</li>
								<li>"Address 123 Main Street, New York"</li>
							</ul>
						</div>
					</div>
				</div>
			</Content>
		</DialogTemplates>
		<DialogButtons>
			<DialogButton Content="Cancel" OnClick="@CloseVoiceDialog" CssClass="dialog-btn-cancel" />
			<DialogButton Content="Process Voice Command" IsPrimary="true" OnClick="@OnProcessTranscriptClick" CssClass="dialog-btn-save" />
		</DialogButtons>
	</SfDialog>
</div>